{{- if not (.Param "hideFooter") }}
<footer class="footer">
  {{- if site.Copyright }}
  <span>{{ site.Copyright | markdownify }}</span>
  {{- else }}
  <span>&copy; {{ now.Year }} <a href="{{ "" | absURL }}">{{ site.Title }}</a></span>
  {{- end -}}
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
  <span>&amp;</span>
  <span>Theme by <a href="https://github.com/reorx/hugo-PaperModX" rel="noopener" target="_blank">PaperModX</a></span>
  <br>
  <span>This Site is <a href="https://github.com/ryanfaiz/blog" rel="noopener noreferrer" target="_blank">Open-Sourced</a> with &#10084;&#65039;</span>
  <span>&middot;</span>
  <span><a href="../terms-of-service-agreement/index.html">Terms of Service</a></span>
  <span>&middot;</span>
  <span><a href="../privacy-policy/index.html">Privacy Policy</a></span>
  <span>&middot;</span>
  <span>Articles Are Licensed Under <a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="nooopener noreferrer" target="_blank">CC BY-NC 4.0</a></span>

</footer>
{{- end }}

{{- if (not site.Params.disableScrollToTop) }}
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>
{{- end }}

{{- partial "extend_footer.html" . }}

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '{{- if (.Param "DisableSmoothScroll") -}}1{{- end -}}' == '1';
    const enableInstantClick = '{{- if (.Param "EnableInstantClick") -}}1{{- end -}}' == '1';
    // instant click and smooth scroll are mutually exclusive
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    // only run this code if smooth scroll should be enabled
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

{{- if (not site.Params.disableScrollToTop) }}
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
{{- end }}

{{- if (not site.Params.disableThemeToggle) }}
<script>
  document.getElementById("theme-toggle").addEventListener("click", () => {
    if (document.body.className.includes("dark")) {
      document.body.classList.remove('dark');
      localStorage.setItem("pref-theme", 'light');
    } else {
      document.body.classList.add('dark');
      localStorage.setItem("pref-theme", 'dark');
    }
  })
</script>
{{- end }}

{{- /* Base64Email */}}
{{- if (.Param "MaskedEmail") }}
<script>
  document.querySelectorAll('.masked-email').forEach((el) => {
    el.innerText = atob(el.innerText);
    el.classList.remove('masked-email')
  })
</script>
{{- end -}}


{{/* Clear ToC Scroll */}}
<script>
  if (window.scrollListeners) {
    // console.log('disable toc scroll', scrollListeners)
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>


{{- if .IsPage }}
  {{- partial "page_footer.html" . }}
{{- end}}

{{- /* Search */}}
{{- if (eq .Layout `search`) -}}
<link crossorigin="anonymous" rel="preload" as="fetch" href="../index.json">
{{- $fastsearch := resources.Get "js/fastsearch.js" | js.Build (dict "params" (dict "fuseOpts" site.Params.fuseOpts)) }}
{{- $fusejs := resources.Get "js/fuse.basic.min.js" }}
{{- if not site.Params.assets.disableFingerprinting }}
{{- $search := (slice $fusejs $fastsearch ) | resources.Concat "assets/js/search.js" | minify | fingerprint }}
<script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}" integrity="{{ $search.Data.Integrity }}"></script>
{{- else }}
{{- $search := (slice $fusejs $fastsearch ) | resources.Concat "assets/js/search.js" | minify }}
<script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}"></script>
{{- end }}

{{- else }}

{{- /* InstantClick.js */}}
{{- if (.Param "EnableInstantClick") }}
{{- $instantclick := resources.Get "js/instantclick.min.js" }}
<script src="{{ $instantclick.RelPermalink }}" data-no-instant
  {{- if site.Params.assets.disableFingerprinting }}integrity="{{ $instantclick.Data.Integrity }}"{{- end }}
></script>
<script data-no-instant>
  // http://instantclick.io/scripts
  // InstantClick.on('change', function(isInitialLoad) {
  //   if (isInitialLoad) {
  //     return;
  //   }
  // });
  InstantClick.init();
</script>
{{- end }}

{{- end -}}

<script>
  if('serviceWorker' in navigator) {
      navigator.serviceWorker
          .register('/sw.js', { scope: '/' })
          .then(function(registration) {
              //console.log('Service Worker Registered');
          });

      navigator.serviceWorker
          .ready
          .then(function(registration) {
              //console.log('Service Worker Ready');
          });
  }
</script>